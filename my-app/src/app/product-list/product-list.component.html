<div class="container">
  <h2 class="mb-4 text-primary">Product List</h2>

  <!-- Filter & Sorting Section -->
  <div class="row">
    <!-- Filter Form -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-primary text-white">Filter</div>
        <div class="card-body">
          <form [formGroup]="filterForm" (ngSubmit)="applyFilters($event)">
            <div class="mb-3">
              <input type="text" class="form-control" placeholder="Filter by ID" formControlName="id" />
            </div>
            <div class="mb-3">
              <input type="text" class="form-control" placeholder="Filter by Name" formControlName="name" />
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <input type="number" class="form-control" placeholder="Min Price" formControlName="minPrice" />
              </div>
              <div class="col-md-6 mb-3">
                <input type="number" class="form-control" placeholder="Max Price" formControlName="maxPrice" />
              </div>
              <div class="col-md-6 mb-3">
                <input type="number" class="form-control" placeholder="Min Volume" formControlName="minVolume" />
              </div>
              <div class="col-md-6 mb-3">
                <input type="number" class="form-control" placeholder="Max Volume" formControlName="maxVolume" />
              </div>
            </div>
            <div class="form-check mb-3">
              <input type="checkbox" class="form-check-input" id="inStock" formControlName="inStockOnly" />
              <label class="form-check-label" for="inStock">In Stock Only</label>
            </div>
            <div class="mb-3">
              <select class="form-select" formControlName="categories" (change)="updateSelectedCategories($event)">
                <option value="">{{getCategoryNames(categoryTreeProductLeaf.id)}}</option>
                <ng-container *ngFor="let category of categoryTreeProductLeaf.children">
                  <option [value]="category.id">{{ getCategoryNames(category.id) }}</option>
                  <ng-container *ngFor="let subCategory of category.children">
                    <option [value]="subCategory.id">- {{ getCategoryNames(subCategory.id) }}</option>
                  </ng-container>
                </ng-container>
              </select>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Sorting Form -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-primary text-white">Sorting</div>
        <div class="card-body">
          <form [formGroup]="sortForm" (ngSubmit)="applySort($event)">
            <div class="row">
              <div class="col-md-6 mb-3">
                <select class="form-select" formControlName="sortKey">
                  <option value="id">ID</option>
                  <option value="name">Name</option>
                  <option value="price">Price</option>
                  <option value="stock">Stock</option>
                  <option value="volume">Volume</option>
                  <option value="categories">Categories</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <select class="form-select" formControlName="sortOrder">
                  <option value="asc">Ascending</option>
                  <option value="desc">Descending</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Product List -->
  <div class="table-responsive mt-4">
    <table class="table table-striped table-hover">
      <thead class="thead">
        <tr>
          <th (click)="setSortKey('id')">ID</th>
          <th (click)="setSortKey('name')">Name</th>
          <th (click)="setSortKey('price')">Price</th>
          <th (click)="setSortKey('stock')">Stock</th>
          <th (click)="setSortKey('volume')">Volume</th>
          <th (click)="setSortKey('categories')">Categories</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of getFilteredProductsArray()">
          <td>{{ product.product.id }}</td>
          <td>{{ product.product.name }}</td>
          <td>{{ product.product.extra['AGA'].PRI }}</td>
          <td>
            <span class="badge" [ngClass]="{'badge-success': product.product.extra['AGA'].LGA > 0, 'badge-danger': product.product.extra['AGA'].LGA === 0}">
              {{ product.product.extra['AGA'].LGA > 0 ? 'In Stock' : 'Out of Stock' }}
            </span>
          </td>
          <td>{{ product.product.extra['AGA'].VOL }}</td>
          <td>{{ getCategoryNames(product.categories) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
